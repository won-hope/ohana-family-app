### ==========================================
### Environment Variables
### ==========================================
@baseUrl = http://localhost:8080
@contentType = application/json
# ⚠️ 아래 subjectId는 'Subject 목록 조회' 후 실제 ID로 교체할 것
@subjectId = e468924d-7952-4d83-9586-6f07102125da


### ==========================================
### 1. Auth & Setup (Onboarding)
### ==========================================

### [Auth] Dev Login (requires spring profile: dev)
POST {{baseUrl}}/auth/dev
Content-Type: {{contentType}}

> {%
    client.global.set("accessToken", response.body.accessToken);
    client.log("Access Token Acquired");
%}

### [Group] Create Group (최초 1회)
POST {{baseUrl}}/groups
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "name": "Ohana Family"
}

### [Group] 내 그룹 목록 조회
GET {{baseUrl}}/groups
Authorization: Bearer {{accessToken}}

### [Subject] 생성 - Baby (도현)
POST {{baseUrl}}/subjects
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "type": "BABY",
  "name": "도현",
  "birthDate": "2025-11-06",
  "notes": "귀여운 아들"
}

### [Subject] 생성 - Pet (Hope)
POST {{baseUrl}}/subjects
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "type": "PET",
  "name": "Hope",
  "notes": "닥스훈트, 심장사상충 매월 25일"
}

### [Subject] 목록 조회 (여기서 ID 확인해서 상단 @subjectId 업데이트)
GET {{baseUrl}}/subjects
Authorization: Bearer {{accessToken}}


### ==========================================
### 2. Domain Actions (Write)
### ==========================================

### [Feeding] 수유 기록 등록
POST {{baseUrl}}/feedings
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "subjectId": "{{subjectId}}",
  "idempotencyKey": "550e8400-e29b-41d4-a716-446655440001",
  "fedAt": "2026-02-06T12:30:00+09:00",
  "amountMl": 160,
  "method": "BOTTLE",
  "note": "꿀꺽꿀꺽 잘 먹음"
}

### [Feeding] 멱등성 테스트 (동일 Key 재전송 -> 에러 혹은 동일 결과)
POST {{baseUrl}}/feedings
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "subjectId": "{{subjectId}}",
  "idempotencyKey": "550e8400-e29b-41d4-a716-446655440001",
  "fedAt": "2026-02-06T13:00:00+09:00",
  "amountMl": 180,
  "method": "BOTTLE",
  "note": "Duplicate Check"
}

### [Care] 대변(Poo) 기록
POST {{baseUrl}}/care-events
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "subjectId": "{{subjectId}}",
  "type": "DIAPER_POO",
  "occurredAt": "2026-02-06T14:00:00+09:00",
  "idempotencyKey": "0f7f07d2-7f4b-4a76-9e52-82c0a1b6a1a1",
  "payload": {
    "color": "GOLD",
    "amount": "MUCH",
    "memo": "황금변! 상태 좋음"
  }
}

### [Care] 목욕(Bath) 기록
POST {{baseUrl}}/care-events
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "subjectId": "{{subjectId}}",
  "type": "BATH",
  "occurredAt": "2026-02-06T19:30:00+09:00",
  "idempotencyKey": "2b64a7a1-19df-4d36-9f2b-1e7fd28f0b7d",
  "payload": { "memo": "오늘은 아빠랑 목욕" }
}


### ==========================================
### 3. Dashboard (Read)
### ==========================================

### [Feeding] 단일 Subject 수유 이력 조회
GET {{baseUrl}}/feedings/subject/{{subjectId}}
Authorization: Bearer {{accessToken}}

### [Care] 단일 Subject 케어 이력 조회
GET {{baseUrl}}/care-events?subjectId={{subjectId}}&date=2026-02-06
Authorization: Bearer {{accessToken}}

### [Unified] 타임라인 통합 조회 (Feeding + Care)
GET {{baseUrl}}/subjects/{{subjectId}}/timeline?date=2026-02-06
Authorization: Bearer {{accessToken}}

### [Summary] 일일 요약 조회
GET {{baseUrl}}/subjects/{{subjectId}}/summary?date=2026-02-06
Authorization: Bearer {{accessToken}}


### ==========================================
### 4. Operations & Integrations
### ==========================================

### [Ops] 배치 강제 실행 (Google Sheets Export)
POST {{baseUrl}}/test/export-now
Authorization: Bearer {{accessToken}}

### [Google] 1) 연결 시작 (OAuth URL 발급)
POST {{baseUrl}}/google/sheets/connect/start
Authorization: Bearer {{accessToken}}

### [Google] 2) Callback (Manual)
# 브라우저에서 위 URL 접속 -> 동의 -> 리다이렉트된 URL의 code, state 복사해서 아래 실행
# 예: http://localhost:8080/google/sheets/connect/callback?code=4/0A...&state=...
GET {{baseUrl}}/google/sheets/connect/callback?code=YOUR_CODE_HERE&state=YOUR_STATE_HERE

### ==========================================
### 5. Health & Growth
### ==========================================

### [Growth] 성장 기록 등록 (키, 몸무게)
POST {{baseUrl}}/health/growth
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "subjectId": "{{subjectId}}",
  "date": "2026-02-19",
  "weight": 7.5,
  "height": 65.0,
  "head": 42.0
}

### [Growth] 홈 화면용 최신 성장 요약 조회
GET {{baseUrl}}/health/growth/latest-summary?subjectId={{subjectId}}
Authorization: Bearer {{accessToken}}

### ==========================================
### 6. Vaccination (예방접종)
### ==========================================

### [Vaccination] 1. 일정 자동 생성 (최초 1회)
# 이 API를 호출하면 구글 캘린더에도 일정이 생성됩니다.
POST {{baseUrl}}/health/vaccinations/{{subjectId}}/init
Authorization: Bearer {{accessToken}}

### [Vaccination] 2. 홈 화면 알림 (지연/임박 리스트)
GET {{baseUrl}}/health/vaccinations/{{subjectId}}/alerts
Authorization: Bearer {{accessToken}}

### [Vaccination] 3. 전체 일정표 (캘린더)
GET {{baseUrl}}/health/vaccinations/{{subjectId}}
Authorization: Bearer {{accessToken}}

### [Vaccination] 4. 접종 완료 체크 (예: B형간염 1차 완료)
# ⚠️ 아래 ID는 '전체 일정표' 조회 후 실제 ID로 교체할 것
@vaccinationId = YOUR_VACCINATION_ID_HERE

POST {{baseUrl}}/health/vaccinations/{{vaccinationId}}/complete
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "date": "2025-11-06",
  "hospital": "서울대병원"
}
